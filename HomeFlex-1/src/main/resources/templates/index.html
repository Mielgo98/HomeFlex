<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
  <head th:replace="fragments/head :: head('HomeFlex - Inicio')"></head>
  <body>
    <header th:replace="fragments/header :: header"></header>

    <main class="container my-4">
      <div class="p-5 mb-4 bg-light rounded-3">
        <div class="container-fluid py-5">
          <h1 class="display-5 fw-bold">Bienvenido a HomeFlex</h1>
          <p class="col-md-8 fs-4">Tu plataforma de alquiler temporal. Encuentra el alojamiento perfecto para tus necesidades o publica tus propiedades.</p>
          <a th:href="@{/propiedades}" class="btn btn-primary btn-lg">Ver propiedades</a>
        </div>
      </div>

      <section class="search-section py-5 bg-light rounded-3 mb-5">
        <div class="container">
          <h2 class="mb-4 text-center">Encuentra tu alojamiento ideal</h2>
          <form id="searchForm" th:action="@{/propiedades}" method="get" class="row g-3 justify-content-center">
            <div class="col-md-4">
              <input type="text" name="ciudad" class="form-control" placeholder="¿Dónde quieres ir?">
              <!-- Lista de sugerencias de ciudades populares si hay datos -->
              <div th:if="${not #lists.isEmpty(ciudadesPopulares)}" class="mt-2 small">
                <span>Ciudades populares: </span>
                <span th:each="ciudad, iterStat : ${ciudadesPopulares}">
                  <a href="#" th:text="${ciudad}" onclick="document.querySelector('input[name=\'ciudad\']').value=this.textContent;return false;"></a>
                  <span th:if="${!iterStat.last}">, </span>
                </span>
              </div>
            </div>
            <div class="col-md-2">
              <input type="date" name="fechaInicio" class="form-control" placeholder="Llegada">
            </div>
            <div class="col-md-2">
              <input type="date" name="fechaFin" class="form-control" placeholder="Salida">
            </div>
            <div class="col-md-2">
              <button type="submit" class="btn btn-primary w-100">Buscar</button>
            </div>
          </form>
        </div>
      </section>

      <section class="featured-properties mb-5">
        <h2 class="mb-4">Propiedades destacadas</h2>
        
        <!-- Mensaje si no hay propiedades -->
        <div th:if="${#lists.isEmpty(propiedadesDestacadas)}" class="alert alert-info text-center">
          <p>No hay propiedades disponibles en este momento.</p>
          <a th:href="@{/propiedades/nueva}" class="btn btn-primary btn-sm mt-2" th:if="${#authorization.expression('hasRole(''ROLE_PROPIETARIO'')')}">
            Publicar una propiedad
          </a>
        </div>
        
        <!-- Grid de propiedades destacadas -->
        <div th:if="${not #lists.isEmpty(propiedadesDestacadas)}" class="row">
          <div th:each="propiedad : ${propiedadesDestacadas}" class="col-md-4 mb-4">
            <div class="card h-100">
              <!-- Imagen de la propiedad o placeholder -->
              <img th:if="${propiedad.fotoPrincipal != null}" th:src="${propiedad.fotoPrincipal}" class="card-img-top" alt="Imagen de propiedad">
              <img th:unless="${propiedad.fotoPrincipal != null}" src="/images/property-placeholder.jpg" class="card-img-top" alt="Imagen de propiedad">
              
              <div class="card-body">
                <h5 class="card-title" th:text="${propiedad.titulo}">Título de propiedad</h5>
                <p class="card-text" th:text="${#strings.abbreviate(propiedad.descripcion, 100)}">Descripción</p>
                <p class="card-text">
                  <i class="bi bi-geo-alt-fill"></i> <span th:text="${propiedad.ciudad + ', ' + propiedad.pais}">Ubicación</span>
                </p>
                <div class="d-flex justify-content-between align-items-center">
                  <span class="price">
                    <strong th:text="${#numbers.formatDecimal(propiedad.precioDia, 0, 'COMMA', 2, 'POINT')} + ' €/noche'">Precio</strong>
                  </span>
                  <a th:href="@{'/propiedades/' + ${propiedad.id}}" class="btn btn-sm btn-outline-primary">Ver detalles</a>
                </div>
              </div>
            </div>
          </div>
        </div>
      </section>
      
      <!-- Sección de promoción para propietarios -->
      <section class="owner-promo py-5 bg-light rounded-3 text-center mb-5">
        <h2 class="mb-3">¿Tienes una propiedad para alquilar?</h2>
        <p class="lead mb-4">Únete a HomeFlex y comienza a obtener ingresos con tu propiedad. Proceso sencillo, pagos seguros y soporte completo.</p>
        <a th:href="@{/propiedades/nueva}" class="btn btn-outline-primary" th:if="${#authorization.expression('hasRole(''ROLE_PROPIETARIO'')')}">Publicar propiedad</a>
      </section>
    </main>

    <footer th:replace="fragments/footer :: footer"></footer>
    
    <!-- Referencia al script de fechas pero sin código en el HTML -->
    <script th:src="@{/js/search.js}"></script>
  </body>
</html>