<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="es">
<head th:replace="~{fragments/head :: head('Detalle Reserva - HomeFlex')}">
    <link rel="stylesheet" th:href="@{/css/reserva.css}" />
    <title>Detalle Reserva - HomeFlex</title>
</head>
<body>
    <header th:replace="~{fragments/header :: header}"></header>

    <main class="container my-4">
        <div class="mb-4">
            <a th:href="@{/reservas/mis-reservas}" class="btn btn-outline-secondary">
                <i class="bi bi-arrow-left me-1"></i> Volver a mis reservas
            </a>
        </div>

        <div class="card shadow-sm">
            <div class="card-header d-flex justify-content-between align-items-center">
                <h3 th:text="${reserva.tituloPropiedad}">Título de la propiedad</h3>
                <span class="badge fs-6"
                      th:classappend="${
                          reserva.estado != null ?
                            (T(com.example.demo.reserva.model.EstadoReserva).SOLICITADA.equals(reserva.estado) ? 'bg-warning' :
                             T(com.example.demo.reserva.model.EstadoReserva).PENDIENTE_PAGO.equals(reserva.estado) ? 'bg-info' :
                             T(com.example.demo.reserva.model.EstadoReserva).PAGO_VERIFICADO.equals(reserva.estado) ? 'bg-primary' :
                             T(com.example.demo.reserva.model.EstadoReserva).CONFIRMADA.equals(reserva.estado) ? 'bg-success' :
                             'bg-danger'
                            )
                          : 'bg-secondary'
                      }"
                      th:text="${reserva.estado}">Estado</span>
            </div>
            <div class="card-body">
                <div class="row mb-3">
                    <div class="col-md-4">
                        <img th:src="${reserva.fotoPropiedad}" class="img-fluid rounded" alt="Imagen de propiedad">
                    </div>
                    <div class="col-md-8">
                        <p>
                            <i class="bi bi-geo-alt-fill me-1"></i>
                            <span th:text="${reserva.ciudadPropiedad + ', ' + reserva.paisPropiedad}">Ciudad, País</span>
                        </p>
                        <p>
                            <i class="bi bi-calendar3 me-1"></i>
                            <strong>Entrada:</strong>
                            <span th:text="${#temporals.format(reserva.fechaInicio, 'dd/MM/yyyy')}">dd/MM/yyyy</span>
                        </p>
                        <p>
                            <i class="bi bi-calendar3-week me-1"></i>
                            <strong>Salida:</strong>
                            <span th:text="${#temporals.format(reserva.fechaFin, 'dd/MM/yyyy')}">dd/MM/yyyy</span>
                        </p>
                        <p>
                            <i class="bi bi-people-fill me-1"></i>
                            <strong>Huéspedes:</strong>
                            <span th:text="${reserva.numHuespedes}">0</span>
                        </p>
                        <p>
                            <i class="bi bi-cash-coin me-1"></i>
                            <strong>Importe total:</strong>
                            <span th:text="${#numbers.formatDecimal(reserva.precioTotal,1,'COMMA',2,'POINT')} + ' €'">0,00 €</span>
                        </p>
                        <p>
                            <i class="bi bi-hash me-1"></i>
                            <strong>Código de reserva:</strong>
                            <span th:text="${reserva.codigoReserva}">ABC123</span>
                        </p>
                    </div>
                </div>

                <!-- Pagos asociados -->
                <div>
                    <h5>Pagos</h5>
                    <table class="table">
                        <thead>
                            <tr>
                                <th>ID sesión</th>
                                <th>Monto</th>
                                <th>Fecha creación</th>
                                <th>Estado</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr th:each="pago : ${pagos}">
                                <td th:text="${pago.idSesion}">ses_123</td>
                                <td th:text="${#numbers.formatDecimal(pago.monto,1,'COMMA',2,'POINT')} + ' ' + pago.moneda">0,00 EUR</td>
                                <td th:text="${#temporals.format(pago.fechaCreacion, 'dd/MM/yyyy HH:mm')}">dd/MM/yyyy HH:mm</td>
                                <td th:text="${pago.estado}">PENDIENTE</td>
                            </tr>
                        </tbody>
                    </table>
                </div>

                <div class="mt-4 text-end">
                    <a th:if="${esInquilino && reserva.estado.name()=='PENDIENTE_PAGO'}"
                       th:href="@{'/pago/iniciar?reservaId=' + ${reserva.id}}"
                       class="btn btn-success me-2">
                        <i class="bi bi-credit-card me-1"></i> Realizar pago
                    </a>
                    <a th:if="${esPropietario && reserva.estado.name()=='SOLICITADA'}"
                       th:href="@{'/reservas/aprobar/' + ${reserva.id}}"
                       class="btn btn-primary me-2">
                        <i class="bi bi-check-lg me-1"></i> Aprobar
                    </a>
                    <a th:if="${esPropietario && reserva.estado.name()=='SOLICITADA'}"
                       th:href="@{'/reservas/cancelar/' + ${reserva.id}}"
                       class="btn btn-danger">
                        <i class="bi bi-x-lg me-1"></i> Cancelar
                    </a>
                </div>
            </div>
        </div>
    </main>

    <footer th:replace="~{fragments/footer :: footer}"></footer>
    <script th:src="@{/js/reserva.js}" defer></script>
</body>
</html>
